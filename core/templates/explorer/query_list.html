{% extends 'core/base.html' %}

{% load i18n %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {% if recent_queries|length > 0 %}
    <p class="govuk-heading-m govuk-!-margin-bottom-2">
      {% trans 'Your '%} {{ recent_queries|length }}  {% trans 'Most Recently Run' %}
    </p>

    <table class="govuk-table">
      <thead class="govuk-table__head">
	<tr class="govuk-table__row">
	  <th scope="col" class="govuk-table__header">Query</th>
	  <th scope="col" class="govuk-table__header">Last Run</th>
	  <th scope="col" class="govuk-table__header">CSV</th>
	</tr>
      </thead>
      <tbody class="govuk-table__body">
	{% for object in recent_queries %}
	<tr class="govuk-table__row">
	  <td class="govuk-table__cell">
	    <a href="{% url 'query_detail' object.query_id %}">
	      {{ object.query.title }}
	    </a>
	  </td>
	  <td class="govuk-table__cell">{{ object.run_at|date:"SHORT_DATETIME_FORMAT" }}</td>
	  <td class="govuk-table__cell">
	    <a href="{% url 'download_query' object.query_id %}">
	      Download
	    </a>
	  </td>
	</tr>
	{% endfor %}
      </tbody>
    </table>
    
    {% endif %}
  </div>
  
  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-heading-m govuk-!-margin-bottom-2">{% trans 'All Queries' %}</p>

    <table class="govuk-table">
      <thead class="govuk-table__head">
	<tr class="govuk-table__row">
	  <th scope="col" class="govuk-table__header">Query</th>
	  <th scope="col" class="govuk-table__header">Download</th>
	  <th scope="col" class="govuk-table__header">Created</th>
	  <th scope="col" class="govuk-table__header">Play</th>
	  <th scope="col" class="govuk-table__header">Delete</th>
	  <th scope="col" class="govuk-table__header">Run Count</th>
	</tr>
      </thead>
      <tbody class="govuk-table__body">
	{% for object in object_list %}
	<tr {% if object.is_in_category %}class="collapse in collapse-{{ object.collapse_target }}"{% endif %}>
          {% if object.is_header %}
          <td colspan="100">
            <strong>
              <span data-toggle="collapse" data-target=".collapse-{{object.collapse_target}}"
                    class="toggle">
		{{ object.title }} ({{ object.count }})</span>
            </strong>
          </td>
          {% else %}
          <td class="name{% if object.is_in_category %} indented{% endif %}">
            <a href="{% url "query_detail" object.id %}">{{ object.title }}</a>
          </td>
          <td>
            <a href="{% url "download_query" object.id %}">Download</a>
          </td>
          <td>{{ object.created_at|date:"SHORT_DATE_FORMAT" }}
            {% if object.created_by_user %}
            by {{ object.created_by_user }}
            {% endif %}
          </td>
          {% if tasks_enabled %}
          <td>
            <a class="email-csv" data-id="{{ object.id }}" href="{% url "email_csv_query" object.id %}"><i class="glyphicon glyphicon-envelope"></i></a>
          </td>
          {% endif %}
          {% if can_change %}
          <td>
            <a href="{% url "explorer_playground" %}?query_id={{ object.id }}">Play</a>
          </td>
          <td>
            <a href="{% url "query_delete" object.id %}">Delete</a>
          </td>
          {% endif %}
          <td>{{ object.run_count }}</td>

          {% endif %}
	</tr>
	{% endfor %}
	
      </tbody>
    </table>
    
  </div>
  
</div>

{% endblock content %}
